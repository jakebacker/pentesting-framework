import nmap

nmap_scans {
    "tcp_fast": "-sV -sC -T4",
    "tcp_full": "-sV -sC -T4 -p-",
    "udp_fast": "-sU -T4",
    "udp_full": "-sU -T4 -p-",
    "os_detection": "-O"
}

windows_switch = "-Pn"

scan_results = []

def scan_callback(host, scan_result):
    scan_results.append((host, scan_result))

def perform_scan(ip: str, scan: str, windows: bool, extra: str):
    args = nmap_scans[scan]
    if not args:
        return
    
    args += " " + extra
    
    if windows:
        args += " " + windows_switch
    

    nm = nmap.PortScanner()

    nm.scan(hosts=ip, arguments=args)

    return nm

def perform_scan_async(ip: str, scan: str, windows: bool, extra: str):
    args = nmap_scans[scan]
    if not args:
        return
    
    args += " " + extra
    
    if windows:
        args += " " + windows_switch
    

    nm = nmap.PortScannerAsync()

    nm.scan(hosts=ip, arguments=args, callback=scan_callback)

